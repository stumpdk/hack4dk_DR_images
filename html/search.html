<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Open Graph data -->
    <meta property="og:title" content="Crowdsourcing DR Images" />
    <meta property="og:url" content="https://hack4dk-2015-stumpdk-1.c9.io/html/index.html" />
    <meta property="og:image" content="https://hack4dk-2015-stumpdk-1.c9.io/frontimage.jpg" />
    <meta property="og:description" content="Help us make DR historic photos accessible!" />
    
    
    <title>DR crowdsourcing - search</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>  
    <script src="js/tagging.js"></script>
    <script src="js/typeahead.bundle.js"></script>
    <link rel="stylesheet" href="css/typeahead.css">   
    
    <style type="text/css">
      body {
      /*    padding-top: 20px; /* Required padding for .navbar-fixed-top. Change if height of navigation changes. */
      }
      
      .thumb {
          margin-bottom: 30px;
      }
      
      footer {
          margin: 50px 0;
      }
    </style>    
  </head>

  <body>

    <nav class="navbar navbar-default">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Crowdsourcing DR history</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="search">Search</a></li>
            <li><a href="about">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
    </nav>

    <div class="container">
      <div id="latest-tags" class="text-center"></div>
      <div id="remote">
        <span class="twitter-typeahead" style="position: relative; display: inline-block;">
          <input class="typeahead" id="search_term" type="text" placeholder="Type search terms here...">
        </span>
      </div>
      <div class="container" id="search_results"></div>
    </div>
    <script>
      var tagSuggestions = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        //prefetch: '../data/films/post_1960.json',
        remote: {
          url: '../api/tags?term=%QUERY',
          wildcard: '%QUERY'
        }
      });
      
      $('#remote .typeahead').typeahead(null, {
        name: 'best-pictures',
        display: 'name',
        source: tagSuggestions,
        minLength: 0
      });
      
      $('#remote').on('typeahead:select', function(e){
        term = $('#search_term').val();
        if(term.trim().length > 0){
          //Perform search
          searchModule.search(term);
          window.history.pushState("", null, "?term=" + term);
          getLatestTags();
        }
      });
      
      var getLatestTags = function()
	    {
    		receiver.getLatestTags().success(function(data){
    			var html = '<div><p>Latest tags: ';
    			data.map(function(value){
    				html = html + '<a href="search?term=' + value.name + '">' + value.name + '</a>&nbsp;';
    			});
    			
    			html = html + '</p></div>';
    			$('#latest-tags').html(html);
    			
    		});
    	};
      
      $(function(){
        getLatestTags();
        term = Helper.gup('term');
        if(term){
          $('#search_term').val(term);
          searchModule.search(term);
        }
      });
      
    </script>
  </body>
</html>